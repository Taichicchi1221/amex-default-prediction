import os
import gc
import shutil
import numpy as np
import pandas as pd

from tqdm.auto import tqdm

TYPE = "test"  # {train, test}

DTYPES = {
    "customer_ID": "object",
    "S_2": "object",
    "P_2": "float32",
    "D_39": "float32",
    "B_1": "float32",
    "B_2": "float32",
    "R_1": "float32",
    "S_3": "float32",
    "D_41": "float32",
    "B_3": "float32",
    "D_42": "float32",
    "D_43": "float32",
    "D_44": "float32",
    "B_4": "float32",
    "D_45": "float32",
    "B_5": "float32",
    "R_2": "float32",
    "D_46": "float32",
    "D_47": "float32",
    "D_48": "float32",
    "D_49": "float32",
    "B_6": "float32",
    "B_7": "float32",
    "B_8": "float32",
    "D_50": "float32",
    "D_51": "float32",
    "B_9": "float32",
    "R_3": "float32",
    "D_52": "float32",
    "P_3": "float32",
    "B_10": "float32",
    "D_53": "float32",
    "S_5": "float32",
    "B_11": "float32",
    "S_6": "float32",
    "D_54": "float32",
    "R_4": "float32",
    "S_7": "float32",
    "B_12": "float32",
    "S_8": "float32",
    "D_55": "float32",
    "D_56": "float32",
    "B_13": "float32",
    "R_5": "float32",
    "D_58": "float32",
    "S_9": "float32",
    "B_14": "float32",
    "D_59": "float32",
    "D_60": "float32",
    "D_61": "float32",
    "B_15": "float32",
    "S_11": "float32",
    "D_62": "float32",
    "D_63": "object",
    "D_64": "object",
    "D_65": "float32",
    "B_16": "float32",
    "B_17": "float32",
    "B_18": "float32",
    "B_19": "float32",
    "D_66": "float32",
    "B_20": "float32",
    "D_68": "float32",
    "S_12": "float32",
    "R_6": "float32",
    "S_13": "float32",
    "B_21": "float32",
    "D_69": "float32",
    "B_22": "float32",
    "D_70": "float32",
    "D_71": "float32",
    "D_72": "float32",
    "S_15": "float32",
    "B_23": "float32",
    "D_73": "float32",
    "P_4": "float32",
    "D_74": "float32",
    "D_75": "float32",
    "D_76": "float32",
    "B_24": "float32",
    "R_7": "float32",
    "D_77": "float32",
    "B_25": "float32",
    "B_26": "float32",
    "D_78": "float32",
    "D_79": "float32",
    "R_8": "float32",
    "R_9": "float32",
    "S_16": "float32",
    "D_80": "float32",
    "R_10": "float32",
    "R_11": "float32",
    "B_27": "float32",
    "D_81": "float32",
    "D_82": "float32",
    "S_17": "float32",
    "R_12": "float32",
    "B_28": "float32",
    "R_13": "float32",
    "D_83": "float32",
    "R_14": "float32",
    "R_15": "float32",
    "D_84": "float32",
    "R_16": "float32",
    "B_29": "float32",
    "B_30": "float32",
    "S_18": "float32",
    "D_86": "float32",
    "D_87": "float32",
    "R_17": "float32",
    "R_18": "float32",
    "D_88": "float32",
    "B_31": "int32",
    "S_19": "float32",
    "R_19": "float32",
    "B_32": "float32",
    "S_20": "float32",
    "R_20": "float32",
    "R_21": "float32",
    "B_33": "float32",
    "D_89": "float32",
    "R_22": "float32",
    "R_23": "float32",
    "D_91": "float32",
    "D_92": "float32",
    "D_93": "float32",
    "D_94": "float32",
    "R_24": "float32",
    "R_25": "float32",
    "D_96": "float32",
    "S_22": "float32",
    "S_23": "float32",
    "S_24": "float32",
    "S_25": "float32",
    "S_26": "float32",
    "D_102": "float32",
    "D_103": "float32",
    "D_104": "float32",
    "D_105": "float32",
    "D_106": "float32",
    "D_107": "float32",
    "B_36": "float32",
    "B_37": "float32",
    "R_26": "float32",
    "R_27": "float32",
    "B_38": "float32",
    "D_108": "float32",
    "D_109": "float32",
    "D_110": "float32",
    "D_111": "float32",
    "B_39": "float32",
    "D_112": "float32",
    "B_40": "float32",
    "S_27": "float32",
    "D_113": "float32",
    "D_114": "float32",
    "D_115": "float32",
    "D_116": "float32",
    "D_117": "float32",
    "D_118": "float32",
    "D_119": "float32",
    "D_120": "float32",
    "D_121": "float32",
    "D_122": "float32",
    "D_123": "float32",
    "D_124": "float32",
    "D_125": "float32",
    "D_126": "float32",
    "D_127": "float32",
    "D_128": "float32",
    "D_129": "float32",
    "B_41": "float32",
    "B_42": "float32",
    "D_130": "float32",
    "D_131": "float32",
    "D_132": "float32",
    "D_133": "float32",
    "R_28": "float32",
    "D_134": "float32",
    "D_135": "float32",
    "D_136": "float32",
    "D_137": "float32",
    "D_138": "float32",
    "D_139": "float32",
    "D_140": "float32",
    "D_141": "float32",
    "D_142": "float32",
    "D_143": "float32",
    "D_144": "float32",
    "D_145": "float32",
}


def main():
    df = pd.read_csv(f"../input/amex-default-prediction/{TYPE}_data.csv", dtype=DTYPES).convert_dtypes()

    # convert integer dtypes
    for col in df.columns:
        if pd.api.types.is_integer_dtype(df[col]):
            df[col] = df[col].astype(pd.Int16Dtype())

    df.to_pickle(f"../input/amex-pickle/{TYPE}.pkl")


if __name__ == "__main__":
    main()
